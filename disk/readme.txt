仮想ディスク装置(1ドライブ仕様)のファームウェアです。
USBメモリ上のディスクイメージファイルが使用出来ます。
要ディスクBIOS 詳細はbios以下のreadme.txtを読んでください。

ファームウェアについて
USB装置との相性が激しすぎるのでファームウェアを2種類用意しました。
必要い応じて使い分けてください。

disk.bin: 標準バージョン
disk-BSTKH100BK.bin: バッファロー製10キーBSTKH100BK対応バージョン


使用法

1. disk.binファイルの後ろにディスクBIOSを連結します。

unixのcatコマンドを使用する例
$ cat disk.bin disk.rom > firmware.bin

windowsのcopyコマンドを使用する例
>copy /b disk.bin + disk.rom firmware.bin

2. uf2conv.exeを用いて1で作成したfirmware.binをuf2ファイルに変換します。

例: windowsコマンドプロンプト上で
uf2conv.exe firmware.bin firmware.uf2

uf2conv.exeはhttps://github.com/piigaa-densetu-two-dai/MSXpiにあります。

3. MSXに刺さっていない状態のMSXπをブートモードでPCに接続します。

MSXπのBOOTSELボタンを押しながらPCとUSB接続して下さい。
接続が成功するとドライブが認識されます。
HOSTジャンパの状態は不問です。

4. MSXπに2で作成したfirmware.uf2ファイルを書き込みします。

3で認識されたドライブにfirmware.uf2をドラッグアンドドロップ(コピー)します。
コピーが完了するとドライブが見えなくなります。

5. 書込みが終わったらPCから外します。

注意：PCとの接続中はバスバッファの入力がフロート状態となります。
あまり良い状態ではないので長時間のPC接続は避けてください。

6. USBメモリのルートディレクトリに使用するディスクイメージをコピーします。

USBメモリはFAT32でフォーマットして下さい。
ディスクラベルの無いUSBメモリ(直にFAT32フォーマットされた物)は問題があるかもしれません。

ディスクイメージのファイル名はdiskN.dsk(N=0～9 例:disk0.dsk, disk1.dsk, ..., disk9.dsk)にして下さい。
デフォルトで使用するイメージファイルはdisk0.dskです。disk0.dskが存在しない場合はイジェクト状態で起動します。
読み取り専用のイメージファイルは書込み禁止のディスクとして扱われます。

7. MSXπにUSBメモリを取り付けて完了

USB変換アダプター(OTGアダプター)が必要です。100円ショップ等で入手して下さい。
MSXπのHOSTジャンパをショートして下さい。

================

ディスクイメージの交換について
MSXπにUSBキーボードを接続する事によりディスクイメージ交換操作が可能になります。
USBキーボードの接続にはUSBハブをご使用ください。

操作方法(当然ですが各キーはUSBキーボードのキーです)

* 数字キー(テンキー可)0～9
値に対応するイメージファイルがマウントされます。
例えば2を押すとdisk2.dskがマウントされます。該当ファイルが無い場合はイジェクト状態になります。

* リターンキー・エンターキー(テンキー可)
イメージファイルがイジェクトされます。

================

ご注意
キーボードに相性問題が出やすいです。
USBハブ、USBメモリ、USBキーボード以外のUSB装置を接続しないでください。
USBハブ、USBメモリ、USBキーボードを複数接続しないでください。
USB装置のホットスワップに対応していません。

バグ
フォーマット機能は未実装です。
disk.macの不具合によりslot0に16k又は32kのRAMが搭載されている機種では正常動作しません。(8kはok)
